import{r as l,d as U,b as A,c as a,a as e,w as d,e as v,v as i,t as s,F as V,f as D,o as u}from"./index-DLEuH-Ju.js";import{a as w}from"./index-NIGUFBhG.js";const L={key:0,class:""},M={key:1,class:""},q={class:"review"},S={key:0},j={key:1},G=["onUpdate:modelValue"],H={key:2},J={key:3},K=["onClick"],O=["onClick"],P=["onClick"],h="https://todolist-api.hexschool.io/",Y={__name:"TodoView",setup(Q){let p=w.create({baseURL:h});const r=l({email:"",password:"",nickname:""}),c=l({email:"",password:""}),T=l(""),$=l(""),m=l({nickname:"",uid:""}),C=l(""),f=async()=>{try{const o=await w.post(`${h}users/sign_up`,r.value);console.log(o.data.uid),T.value=o.data.uid}catch(o){console.log("error",o)}},E=async()=>{try{const o=await w.post(`${h}users/sign_in`,c.value);console.log(o),$.value=o.data.token,document.cookie=`customTodoToken=${o.data.token};path=/`}catch(o){console.log("error",o)}};U(async()=>{C.value=document.cookie.replace(/(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$/i,"$1"),p.interceptors.request.use(t=>(t.headers.Authorization=C.value,t));const o=await p.get("users/checkout");m.value=o.data});const y=l(""),F=l([]),x=l([]),k=l(!1),B=async()=>{try{await p.post("todos",{content:y.value}),y.value="",g()}catch(o){console.log("get todos error",o)}},I=()=>{k.value=!k.value},N=async(o,t)=>{try{await p.put(`todos/${o}`,{content:t}),k.value=!1,g()}catch(n){console.log("update todos error",n)}},R=async o=>{try{await p.delete(`todos/${o}`),g()}catch(t){console.log("update todos error",t)}},z=async o=>{try{await p.patch(`todos/${o}/toggle`),g()}catch(t){console.log("update todos error",t)}};A(()=>{let o=0;return F.value.forEach(t=>{o+=t.price*1}),o}),U(()=>{g()});async function g(){try{const o=document.cookie.replace(/(?:^|.*;\s*)customTodoToken\s*=\s*([^;]*).*$/i,"$1"),t=await w.get(`${h}todos`,{headers:{Authorization:o}});console.log(t.data),x.value=t.data.data}catch(o){console.log("get todos error",o)}}return(o,t)=>(u(),a(V,null,[t[9]||(t[9]=e("h1",null,"This is an todo page",-1)),t[10]||(t[10]=e("h2",null,"register",-1)),d(e("input",{type:"email",placeholder:"Email","onUpdate:modelValue":t[0]||(t[0]=n=>r.value.email=n)},null,512),[[i,r.value.email]]),d(e("input",{type:"text",placeholder:"password","onUpdate:modelValue":t[1]||(t[1]=n=>r.value.password=n)},null,512),[[i,r.value.password]]),d(e("input",{type:"text",placeholder:"nickName","onUpdate:modelValue":t[2]||(t[2]=n=>r.value.nickname=n)},null,512),[[i,r.value.nickname]]),t[11]||(t[11]=e("br",null,null,-1)),v(" "+s(r.value)+" ",1),e("button",{type:"button",onClick:f},"sign up"),v(" uid: "+s(T.value)+" ",1),t[12]||(t[12]=e("br",null,null,-1)),t[13]||(t[13]=e("h2",null,"sign in",-1)),d(e("input",{type:"email",placeholder:"Email","onUpdate:modelValue":t[3]||(t[3]=n=>c.value.email=n)},null,512),[[i,c.value.email]]),d(e("input",{type:"text",placeholder:"password","onUpdate:modelValue":t[4]||(t[4]=n=>c.value.password=n)},null,512),[[i,c.value.password]]),t[14]||(t[14]=e("br",null,null,-1)),v(" "+s(c.value)+" ",1),e("button",{type:"button",onClick:E},"sign in"),v(" token: "+s($.value)+" ",1),t[15]||(t[15]=e("h2",null,"validate",-1)),v(" "+s(m.value)+" ",1),m.value.uid?(u(),a("div",L,[e("p",null,s(m.value.nickname),1),e("p",null,s(m.value.uid),1)])):(u(),a("div",M,"you're not log in yet")),e("div",q,[t[7]||(t[7]=e("h2",null,"todo",-1)),t[8]||(t[8]=e("br",null,null,-1)),d(e("input",{type:"text","onUpdate:modelValue":t[5]||(t[5]=n=>y.value=n)},null,512),[[i,y.value]]),v(" "+s(y.value)+" ",1),e("button",{type:"button",onClick:B},"add todo"),e("table",null,[t[6]||(t[6]=e("thead",null,[e("tr",null,[e("th",null,"content"),e("th",null,"status"),e("th",null,"delete")])],-1)),e("tbody",null,[(u(!0),a(V,null,D(x.value,n=>(u(),a("tr",{key:n.id},[k.value?(u(),a("td",j,[d(e("input",{type:"text","onUpdate:modelValue":b=>n.content=b},null,8,G),[[i,n.content]])])):(u(),a("td",S,s(n.content),1)),e("td",null,s(n.status),1),k.value?(u(),a("td",J,[e("button",{type:"button",onClick:b=>N(n.id,n.content)},"confirm update",8,K)])):(u(),a("td",H,[e("button",{type:"button",onClick:I},"update")])),e("td",null,[e("button",{type:"button",onClick:b=>R(n.id)},"delete",8,O)]),e("td",null,[e("button",{type:"button",onClick:b=>z(n.id)},"toggle status",8,P)])]))),128))])])])],64))}};export{Y as default};
